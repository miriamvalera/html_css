<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Ejercicio 6 DIAPO 19</title>
		<link rel="stylesheet" type="text/css" href="estilo.css" />
	</head>
	<body>
		<h1>Mis fotitos</h1>
		
		<section id="galeria">

			<figure onclick="abrir(this);">
				<img src="imagenes/abeja.png" alt="abeja" 
                              data-lugar="panal de Sabadell" data-fecha="2019-07-10" />
				<figcaption>Abeja</figcaption>
			</figure>
			
			<figure onclick="abrir(this);">
				<img src="imagenes/abeja2.png" alt="abeja2" 
                              data-lugar="panal de Terrassa" data-fecha="2019-07-12" />
				<figcaption>Abeja 2</figcaption>
			</figure>
			
			<figure onclick="abrir(this);">
				<img src="imagenes/agua.png" alt="agua" 
                               data-lugar="Torrent del Capellà" data-fecha="2019-07-13" />
				<figcaption>Agua</figcaption>
			</figure>
			
			<figure onclick="abrir(this);">
				<img src="imagenes/ajos.png" alt="ajos" 
                               data-lugar="Mercat Central" data-fecha="2019-07-17"/>
				<figcaption>Ajos</figcaption>
			</figure>
		</section>
	    <script>
              function abrir(figura){
                    //recuperar la información necesaria de la figra original
                    //src, alt y datos extra de la imagen y del figcaption 
                    var imagen = figura.getElementsByTagName('img')[0];
                    var fig_text = figura.getElementsByTagName('figcaption')[0].innerHTML;

                    //crear una nueva figure de clase .grande
                    var nuevaFigura = document.createElement('figure');
                    nuevaFigura.setAttribute('class','grande');

                    //crear una nueva imagen con el mismo src y alt que la imagen de la figura original
                    var nuevaImagen = document.createElement('img');
                    nuevaImagen.setAttribute('src',imagen.src);
                    nuevaImagen.setAttribute('alt',imagen.alt);

                    //crear el figcaption con el mismo innerHTMl que el de la figure original
                    var nuevoFigcaption = document.createElement('figcaption');
                    nuevoFigcaption.innerHTML = fig_text;

                    //crear dos elementos con el data personalizado
                    var parrafo1 = document.createElement('p');
                    parrafo1.innerHTML = imagen.dataset.lugar;

                    var parrafo2 = document.createElement('p');
                    parrafo2.innerHTML = imagen.dataset.fecha;

                    //crear una imagen con x de cerrar y añadir class='cerrar'
                    var imagenCerrar = document.createElement('img');
                    imagenCerrar.setAttribute('src', 'imagenes/cerrar.png');
                    imagenCerrar.setAttribute('alt','Cerrar');
                    imagenCerrar.setAttribute('class','cerrar');

                    //Hago que, al clicar en la imagen cerrar, se borre la figure
                    imagenCerrar.onclick = function(){
                         this.parentElement.remove();
                    }

                    //si la figura tiene imagen anterior, crear flecha hacia atras
                    var anterior = figura.previousElementSibling;
                    if(anterior!=null){
                         var enlaceAnterior = document.createElement('a');
                         enlaceAnterior.innerHTML = 'Anterior';
                         enlaceAnterior.setAttribute('class','anterior');
                         enlaceAnterior.onclick = function(){
                              this.parentNode.remove();
                              abrir(anterior);
                         }
                    }

                    //Si la figura tiene imagen siguiente, crear flecha hacia delante
                    var siguiente = figura.nextElementSibling;
                    if(siguiente!=null){
                         var enlaceSiguiente = document.createElement('a');
                         enlaceSiguiente.innerHTML = "Siguiente";
                         enlaceSiguiente.setAttribute('class','siguiente');
                          enlaceSiguiente.onclick = function(){
                              this.parentNode.remove();
                              abrir(siguiente);
                         }
                    }

                    //poner las dos imagenes, el figcaption y los elementos con la info adicional dentro de la figura creada
                    nuevaFigura.appendChild(imagenCerrar);
                    nuevaFigura.appendChild(nuevaImagen);
                    if(enlaceAnterior!=undefined){
                         nuevaFigura.appendChild(enlaceAnterior);
                    }
                    if(enlaceSiguiente!=undefined){
                         nuevaFigura.appendChild(enlaceSiguiente);
                    }
                    nuevaFigura.appendChild(nuevoFigcaption);
                    nuevaFigura.appendChild(parrafo1);
                    nuevaFigura.appendChild(parrafo2);

                    //Poner la figura creada en el body del documento
                    document.body.appendChild(nuevaFigura);

              } 
          </script>
	</body>
</html>
